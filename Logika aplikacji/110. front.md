Poniżej masz opis UI tak, żeby **pokrywał cały proces Blueprint ModMarka** w zakresie, który ustaliliśmy (Market → Setup Planned/Blocked), z myślą o aplikacji “process enforcer”. Każda zakładka ma jasno określony cel, funkcje, wejścia/wyjścia i blokady.

---

## Globalne zasady UI (obowiązują wszędzie)

* **Stage locking**: UI nie pozwala przejść dalej, jeśli brakuje wymaganych pól (pokazuje `missing_fields`).
* **Reason-first**: każda blokada lub downgrade ma listę `reason codes` (chips + tooltip).
* **AUTO/SEMI/MANUAL**: przy każdym polu badge źródła; manual override jest jawny.
* **No-trade jest wynikiem**: UI ma umieć wyświetlić “Today: No Trade” jako poprawny stan.
* **Top Setups cap**: licznik dzienny/tygodniowy widoczny stale (np. “Top setups: 2/3 used”).
* **Jedna prawda**: snapshoty rynku i decyzje są “zapisane” (wersjonowane) — UI pokazuje timestamp “z jakiego kontekstu liczono”.

---

# Nawigacja główna (zakładki)

1. **Dashboard**
2. **Market (SPY Gate)**
3. **Planning**
4. **Watchlist**
5. **Setups**
6. **Policies (Admin / optional w MVP)**

---

## 1) Dashboard (centrum dowodzenia)

### Cel

Jedno miejsce, które odpowiada: **czy dziś wolno handlować i jakie są top setupy**.

### Funkcje

* Pasek stanu rynku: `MarketPermission` (FULL/REDUCED/OBS/BLOCKED) + kluczowe tagi (bias, regime, VIX, breadth).
* Komunikat “No Trade Today” jeśli BLOCKED/OBS + lista powodów.
* Lista “Top Candidates” posortowana wg rankingu/grade:

  * status: `PLANNED / OBSERVATION_ONLY / BLOCKED`
  * grade (jeśli jest)
  * najważniejsze reason codes (max 3 chips + “+n”)
  * szybkie akcje: **Open Setup**, **Evaluate**, **Block**, **Pin**
* Liczniki: “Top setups cap” + ile zostało do limitu.

### Wyjście użytkownika

* klik w setup → przejście do Setup Detail/Wizard
* szybki start: “Create new setup” (z shortlisty lub wpisanie tickera)

---

## 2) Market (SPY Gate)

### Cel

Zrobić i utrzymać **Market Context Layer** jako “source of truth” na dzień: snapshot + permission.

### Sekcje UI

#### A) Current Snapshot

* pola: bias, regime, structure, location, room, VIX level/direction, breadth, divergences, inter-market alignment
* przy każdym polu: badge `AUTO/SEMI/MANUAL`
* przycisk: **Recalculate Permission** (jeśli snapshot zmieniony)

#### B) Intraday / Conflicts

* tag: intraday environment (trend/range/chop)
* tag: environment conflict (weekly vs daily vs intraday)
* tag: catalyst flag (makro risk / event soon)

#### C) Permission Output

* wynik: FULL/REDUCED/OBS/BLOCKED
* pokazuje:

  * risk caps (tylko informacyjnie w tym scope)
  * reason codes (dlaczego reduced/blocked)

#### D) History (Audit)

* lista snapshotów z dzisiaj / ostatnie dni (timestamp + permission)
* możliwość “view snapshot” (read-only)

### Blokady

* Jeśli nie ma snapshotu i permission na dziś → Setup Wizard nie pozwala przejść do “Evaluate”.

---

## 3) Planning (Weekly + Daily)

### Cel

Wymusić Blueprintowy rytm: **weekly mode + daily plan**.

### Sekcje UI

#### A) Weekly Mode

* wybór: trend / range / volatile
* notatka: “type of week”
* status: set / not set

#### B) Daily Plan (Pre-market)

* scenariusze: bull / bear / no-trade (krótkie pola tekstowe)
* “Plan Locked” toggle:

  * dopóki nie lock → system ogranicza do OBSERVATION_ONLY (lub blokuje PLANNED)

#### C) Daily Limits

* ustawienie (lub wyświetlenie z policy):

  * top setups only: limit X
* podgląd: “remaining today”

### Blokady

* Bez ustawionego weekly mode i daily plan (locked) → nie można dostać statusu `PLANNED` (max `OBSERVATION_ONLY`).

---

## 4) Watchlist (Core + Shortlist)

### Cel

Operować na “najlepszych nazwach”, a nie przypadkowych tickerach.

### Sekcje UI

#### A) Core Watchlist

* lista tickerów
* tagi: sector, liquidity status, behavior (clean/messy)
* akcje: add/remove, tag leader/laggard

#### B) Daily Shortlist

* generowana z core (w MVP może być manual)
* dla każdego tickera szybkie wskaźniki:

  * liquidity pass/fail
  * alignment pass/fail
  * RS/RW tag
* CTA: **Create Setup Candidate**

### Blokady

* Ticker, który failuje liquidity gate, nie może przejść do setup candidate (lub przechodzi od razu jako BLOCKED z reason code).

---

## 5) Setups (Workflow)

Ta zakładka ma dwa główne widoki:

* **List View (pipeline)**
* **Setup Wizard / Setup Detail**

---

### 5A) Setups List (Pipeline)

#### Cel

Zobaczyć wszystkie setupy w procesie i ich statusy.

#### Kolumny / filtry

* status: DRAFT / CANDIDATE / DEFINED / EVALUATED / PLANNED / OBS / BLOCKED
* grade, ticker, setup type, updated_at
* filtr: only planned, only blocked, only needs definition
* sort: ranking/grade/time

#### Akcje szybkie

* Evaluate (jeśli ready)
* Duplicate (copy setup template)
* Archive

---

### 5B) Setup Wizard (kluczowy proces)

Wizard jest zrobiony jako “kroki” i UI wymusza kolejność.

#### Krok 1: Candidate (Opportunity Selection)

* pola:

  * ticker
  * setup type (pullback/breakout/range/reversal attempt)
  * key level(s)
  * location (near level / middle)
  * structure quality (clean/messy)
  * room to move (manual/semi)
  * HTF confirmation (yes/no)
  * RS/RW tag + continuity tag
  * sector/index alignment tags
* UI pokazuje wyniki gates:

  * liquidity pass/fail
  * alignment pass/fail
  * konflikt HTF/MTF
* CTA: **Save Candidate**

**Wyjście:** `CANDIDATE_CREATED`

---

#### Krok 2: Definition (Thesis & Risk)

* required:

  * thesis (1–2 zdania)
  * must-happen (jednoznaczny trigger warunku)
  * invalidation level
  * targets (TP1/TP2)
* automatycznie liczone:

  * RR
* walidacje:

  * RR >= minRR
  * invalidation rzeczywiście neguje tezę (checkbox + reason jeśli nie)
  * clarity toggle “obvious”
* CTA: **Complete Definition**

**Wyjście:** `DEFINITION_COMPLETED`

---

#### Krok 3: Evaluate (Quality & Decision)

* pokazuje:

  * market permission (z Market tab)
  * grade A/B/C/D (ze scoringu)
  * policy results:

    * simplicity/selectivity
    * edge concentration (whitelist)
    * top setups cap check
* wynik:

  * status `PLANNED / OBSERVATION_ONLY / BLOCKED`
  * reason codes

CTA:

* **Finalize**
* **Revise** (wraca do kroku z brakami)
* **Archive**

**Wyjście:** `EVALUATED` + final status

---

## 6) Policies (Admin / opcjonalne)

### Cel

Miejsce do ustawień progów i polityk bez zmiany kodu.

### Sekcje

* minRR
* top setups limit
* definicja “obvious” (manual flag + zasady)
* edge concentration whitelist (dozwolone setup types)
* mapping grade → sizing_profile (informacyjnie w tym scope)
* reason codes registry (label/severity)

---

# Dodatkowe elementy UI (komponenty wspólne)

* **Reason Chips**: kolor/severity + tooltip “co poprawić”
* **Missing Fields Panel**: lista braków + przycisk “jump to field”
* **Source Badge**: AUTO/SEMI/MANUAL
* **Context Header**: u góry Setup Detail zawsze: MarketPermission + WeeklyMode + DailyPlanLocked

---

# Minimalna mapa procesu (jak user przez to przechodzi)

1. `Market` → ustawia snapshot i permission
2. `Planning` → weekly mode + daily plan lock
3. `Watchlist` → wybiera ticker → create candidate
4. `Setups` (Wizard) → candidate → definition → evaluate
5. `Dashboard` → widzi top planned/obs/blocked + reasons

---
Poniżej dostajesz **3 rzeczy naraz** (żeby frontendowiec mógł budować bez domysłów):

1. **Specyfikacja UI komponentów** (propsy, stany, akcje)
2. **Wireframe checklist** (pola + walidacje + CTA per ekran)
3. **Routing map** (ścieżki URL + permissions)

Zakres: **Market → Setup Planned/Blocked** (bez execution/management/review/portfolio/psych).

---

# 1) Specyfikacja UI komponentów

## 1.1 Komponenty globalne

### `AppShell`

* **Props:** `user`, `navItems`, `topBar`
* **Stany:** `isNavCollapsed`
* **Akcje:** `onLogout()`, `onNavigate(path)`

### `ContextHeader`

Pokazuje globalny kontekst procesu.

* **Props:**
  `marketPermission`, `marketTags[]`, `weeklyMode`, `dailyPlanLocked`, `topSetupsUsed`, `topSetupsCap`
* **Stany:** brak
* **Akcje:** `onOpenMarket()`, `onOpenPlanning()`

### `SourceBadge`

* **Props:** `source: 'AUTO'|'SEMI'|'MANUAL'`
* **Stany:** brak
* **Akcje:** brak

### `ReasonChips`

* **Props:** `reasons: Array<{code,label,severity:'info'|'warn'|'block'}>`, `maxVisible?: number`
* **Stany:** `isExpanded`
* **Akcje:** `onClickReason(code)`

### `MissingFieldsPanel`

* **Props:** `missingFields: Array<{field,label,step?: 'candidate'|'definition'|'evaluate'}>`
* **Stany:** brak
* **Akcje:** `onJumpTo(field)` / `onJumpToStep(step)`

### `StageLockBanner`

* **Props:** `locked: boolean`, `lockReasons: string[]`
* **Stany:** brak
* **Akcje:** brak

---

## 1.2 Market (SPY Gate)

### `MarketPermissionCard`

* **Props:** `permission: 'FULL'|'REDUCED'|'OBSERVATION'|'BLOCKED'`, `reasons[]`, `updatedAt`
* **Stany:** brak
* **Akcje:** `onRecalculate()`

### `MarketSnapshotForm`

* **Props:**
  `snapshot`, `schema` (lista pól), `readOnly?: boolean`
* **Stany:** `dirty`, `errors`, `overrideMode`
* **Akcje:** `onChange(field,value,source)`, `onSave()`, `onReset()`

### `MarketTagsPanel`

* **Props:** `tags: Array<{key,label,value,source}>`
* **Stany:** brak
* **Akcje:** brak

### `SnapshotHistoryList`

* **Props:** `items: Array<{id,createdAt,permission,tagsSummary}>`
* **Stany:** `selectedId`
* **Akcje:** `onSelect(id)`

---

## 1.3 Planning (Weekly/Daily)

### `WeeklyModePicker`

* **Props:** `value: 'TREND'|'RANGE'|'VOLATILE'|null`, `locked?: boolean`
* **Stany:** `dirty`
* **Akcje:** `onSet(value)`

### `DailyPlanForm`

* **Props:** `plan: {bull?:string,bear?:string,noTrade?:string}`, `locked: boolean`
* **Stany:** `dirty`, `errors`
* **Akcje:** `onChange(field,value)`, `onSave()`, `onLock()`, `onUnlock()` *(unlock tylko admin lub w v1.1)*

### `TopSetupsCapCard`

* **Props:** `used:number`, `cap:number`, `policySource:'SYSTEM'|'ADMIN'`
* **Stany:** brak
* **Akcje:** brak

---

## 1.4 Watchlist

### `WatchlistTable`

* **Props:** `rows: Array<{ticker,sector,liquidityStatus,behaviorTag,rsTag}>`
* **Stany:** `filter`, `sort`, `selectedTickers[]`
* **Akcje:** `onAddTicker(ticker)`, `onRemoveTicker(ticker)`, `onTagChange(ticker,tag)`

### `ShortlistTable`

* **Props:** `rows: Array<{ticker,liquidityPass,alignmentPass,reasons[]}>`
* **Stany:** `filter`
* **Akcje:** `onCreateCandidate(ticker)`

---

## 1.5 Setups

### `SetupsPipelineBoard`

* **Props:** `columns: {status: SetupStatus, items: SetupCardData[]}[]`
* **Stany:** `filters`, `search`
* **Akcje:** `onOpenSetup(id)`, `onEvaluate(id)`, `onArchive(id)`

### `SetupCard`

* **Props:** `{id,ticker,setupType,status,grade?,reasons[],updatedAt,rank?}`
* **Stany:** brak
* **Akcje:** `onOpen()`

### `SetupWizard`

* **Props:** `setupId`, `initialStep?: 'candidate'|'definition'|'evaluate'`
* **Stany:** `currentStep`, `saving`, `errors`, `missingFields`
* **Akcje:** `onNext()`, `onBack()`, `onSaveDraft()`

#### `CandidateStepForm`

* **Props:** `candidate`, `marketPermission`, `validation`
* **Stany:** `dirty`, `errors`
* **Akcje:** `onSave()`

#### `DefinitionStepForm`

* **Props:** `definition`, `computed:{rr:number}`, `minRR:number`
* **Stany:** `dirty`, `errors`
* **Akcje:** `onSave()`

#### `EvaluateStepPanel`

* **Props:** `decision`, `policies`, `reasons[]`
* **Stany:** `evaluating`
* **Akcje:** `onEvaluate()`, `onFinalize()`

---

## 1.6 Dashboard

### `TopSetupsList`

* **Props:** `items: SetupCardData[]`, `cap`, `used`
* **Stany:** `filterPlannedOnly`
* **Akcje:** `onOpenSetup(id)`

---

# 2) Wireframe checklist (pola + walidacje + CTA per ekran)

## 2.1 Dashboard `/dashboard`

**Pola/sekcje:**

* MarketPermission + tagi (bias/regime/VIX/breadth/location/room)
* Top setups counter (used/cap)
* Lista setupów (planned/obs/blocked)

**Walidacje:**

* brak

**CTA:**

* `Open Market`
* `Open Planning`
* `Create Setup`
* `Open Setup`

---

## 2.2 Market `/market`

**Sekcje/pola:**

* Snapshot form: bias, regime, structure, location, room, VIX level, VIX direction, breadth, divergences, inter-market
* Intraday tag: trend/range/chop
* Conflict tag: weekly vs daily vs intraday
* Catalyst flag: true/false
* Permission output: FULL/REDUCED/OBS/BLOCKED + reasons

**Walidacje:**

* snapshot minimalny do permission: bias + regime + VIX tag + breadth tag *(wg MVP)*
* jeśli braki → permission = OBS/ BLOCKED + reason `MISSING_MARKET_FIELDS`

**CTA:**

* `Save Snapshot`
* `Recalculate Permission`

---

## 2.3 Planning `/planning`

**Pola:**

* WeeklyMode (trend/range/volatile)
* DailyPlan: bull/bear/no-trade (krótkie teksty)
* DailyPlanLocked toggle
* Top setups cap (read-only z policy)

**Walidacje:**

* nie można `Lock` bez min. 1 scenariusza
* jeśli `DailyPlanLocked=false` → setup nie może dostać statusu `PLANNED` (max OBS)

**CTA:**

* `Save`
* `Lock Plan`

---

## 2.4 Watchlist `/watchlist`

**Pola:**

* Core list: add/remove, tag behavior
* Shortlist: liquidity/alignment pass/fail + reasons

**Walidacje:**

* `Create Candidate` disabled jeśli liquidity fail (lub tworzy od razu BLOCKED)

**CTA:**

* `Add Ticker`
* `Create Setup Candidate`

---

## 2.5 Setups pipeline `/setups`

**Pola:**

* kolumny statusów + filtry + search
* każdy setup: ticker, type, status, grade, reasons

**Walidacje:**

* brak

**CTA:**

* `Open`
* `Evaluate` (disabled jeśli missing required)
* `Archive`

---

## 2.6 Setup wizard `/setups/:id`

### Krok 1: Candidate

**Pola (min):**

* ticker (read-only po utworzeniu)
* setup type
* key level(s)
* location (near level / middle)
* structure quality (clean/messy)
* room to move (tag)
* HTF confirmation (yes/no)
* RS/RW tag + continuity tag
* sector/index alignment tags
* liquidity/alignment status + reasons (read-only)

**Walidacje (blokady):**

* required: setup type, key level, location, structure quality, room
* jeśli liquidity/alignment fail → evaluate kończy się BLOCKED

**CTA:**

* `Save Candidate`
* `Next`

---

### Krok 2: Definition

**Pola (required):**

* thesis
* must-happen
* invalidation level
* targets (TP1/TP2)
* RR (auto)

**Walidacje (blokady):**

* required fields: thesis, must-happen, invalidation, targets
* RR >= minRR → inaczej `RR_TOO_LOW` i brak przejścia do PLANNED

**CTA:**

* `Save Definition`
* `Next`

---

### Krok 3: Evaluate

**Sekcje:**

* market permission (read-only)
* grade A/B/C/D
* policy results: obvious?, top setups cap, edge whitelist
* final status + reasons

**Walidacje:**

* nie można evaluate jeśli `DailyPlanLocked=false` (reason `PLAN_NOT_LOCKED`)
* top setups cap reached → OBS lub BLOCKED (policy)

**CTA:**

* `Evaluate`
* `Finalize` (zapis statusu)

---

# 3) Routing map (ścieżki URL + permissions)

## Role

* `USER`
* `ADMIN` (opcjonalnie na v1.0)

## Routes

### Public

* `/login` (USER/ADMIN)

### Protected (USER)

* `/dashboard`
* `/market`
* `/planning`
* `/watchlist`
* `/setups`
* `/setups/new` *(opcjonalnie, jeśli tworzenie bez shortlisty)*
* `/setups/:id`

### Admin (opcjonalne)

* `/admin/policies`
* `/admin/reason-codes`
* `/admin/users`

## Uprawnienia akcji (nie tylko wejście na stronę)

* `Evaluate setup`:

  * wymaga `MarketPermission` istnieje dla dnia
  * wymaga `DailyPlanLocked=true` (w MVP)
  * wymaga kompletnej Definition (required fields)

* `Finalize status=PLANNED`:

  * wymaga brak hard fails (RR, missing fields, market blocked)
  * wymaga “top setups cap” nieprzekroczony (albo kończy w OBS)

* `Edit policies`:

  * tylko ADMIN

---